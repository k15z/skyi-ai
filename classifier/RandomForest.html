<!DOCTYPE html>

<html>
<head>
  <title>RandomForest.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="..\docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>RandomForest.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>DecisionTree = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./DecisionTree'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This class implements a random forest by building a DecisionTree array. Since
the current DecisionTree implementation is already heavily randomized and is
unlikely to overfit, this class does not split up the data set. Instead, it 
passes the entire data set to each DecisionTree for processing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RandomForest</span></span>
    constructor: <span class="hljs-function"><span class="hljs-params">(num_trees=<span class="hljs-number">100</span>, depth=<span class="hljs-number">2</span>)</span> -&gt;</span>
        @trees = []
        @depth = depth
        @num_trees = num_trees</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Return a JSON string containing an array of strings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    save: <span class="hljs-function">-&gt;</span>
        trees = []
        <span class="hljs-keyword">for</span> tree <span class="hljs-keyword">in</span> @trees
            trees.push(tree.save())
        <span class="hljs-keyword">return</span> JSON.stringify(trees)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Load trees from JSON string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    load: <span class="hljs-function"><span class="hljs-params">(str)</span> -&gt;</span>
        trees = []
        models = JSON.parse(str)
        <span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> models
            tree = <span class="hljs-keyword">new</span> DecisionTree()
            tree.load(model)
            trees.push(tree)
        @trees = trees</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Create and fit <code>num_trees</code> decision trees.</p>
<ul>
<li><code>x</code> should be a 2d array of size num_samples * num_features</li>
<li><code>y</code> should an array of size num_samples.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fit: <span class="hljs-function"><span class="hljs-params">(x, y, depth=<span class="hljs-number">3</span>)</span> -&gt;</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..@num_trees]
            tree = <span class="hljs-keyword">new</span> DecisionTree(@depth)
            @trees.push(tree)
            tree.fit(x, y)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Return an array of probability distributions.</p>
<ul>
<li><code>x</code> should be a 2d array of size num_samples * num_features</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    predict: <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
        y = []
        <span class="hljs-keyword">for</span> x_i <span class="hljs-keyword">in</span> x
            y.push(@predictOne(x_i))
        <span class="hljs-keyword">return</span> y</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Return the probability distributions over <code>y</code>.</p>
<ul>
<li><code>x_i</code> should be an array of size num_features</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    predictOne: <span class="hljs-function"><span class="hljs-params">(x_i)</span> -&gt;</span>
        y_i = []
        <span class="hljs-keyword">for</span> tree <span class="hljs-keyword">in</span> @trees
            y_i.push(tree.predictOne(x_i))
        <span class="hljs-keyword">return</span> @_collate(y_i)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Combine the counts for each tree into one distribution.</p>
<ul>
<li><code>arr</code> should be an array of objects with shared labels</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _collate: <span class="hljs-function"><span class="hljs-params">(arr)</span> -&gt;</span>
        acc = {}
        <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> arr
            <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> obj
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> acc[key]
                    acc[key] = <span class="hljs-number">0</span>
                acc[key] += value
        <span class="hljs-keyword">return</span> acc

<span class="hljs-built_in">module</span>.exports = RandomForest</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
